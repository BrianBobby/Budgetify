<%- include('partials/header.ejs'); -%>

<div class="container">
    <h1>Calculate Savings Goal</h1>
    <div>
        <form>
            <label for="saveAmount">Target Amount to Save:</label>
            <input type="number" id="saveAmount" name="saveAmount" required>

            <label for="savedAlready">Amount Already Saved:</label>
            <input type="number" id="savedAlready" name="savedAlready" required>

            <label for="saveDate">Target Date (MM/DD/YYYY):</label>
            <input type="date" id="saveDate" name="saveDate" required>

            <input type="button" value="Submit" onclick="handleSubmit()">
        </form>
    </div>

    <!-- Result Section -->
    <div id="result" style="margin-top: 20px;"></div>

    <form action="/" method="get" style="margin-top: 20px;">
        <input type="submit" value="Return to Homepage">
    </form>
</div>

<script>
function monthDiff(d1, d2) {
  return (d2.getFullYear() - d1.getFullYear()) * 12 + (d2.getMonth() - d1.getMonth()) + (d2.getDate() >= d1.getDate() ? 0 : -1);
}

function handleSubmit() {
  const targetAmount = parseFloat(document.getElementById('saveAmount').value) || 0;
  const alreadySaved = parseFloat(document.getElementById('savedAlready').value) || 0;
  const targetDateStr = document.getElementById('saveDate').value;
  const resultDiv = document.getElementById('result');

  const currentDate = new Date();
  const targetDate = new Date(targetDateStr);

  if (isNaN(targetDate.getTime())) {
    resultDiv.innerHTML = "<p>Please choose a valid target date.</p>";
    return;
  }

  const monthsLeft = monthDiff(currentDate, targetDate);
  const amountLeft = Math.max(0, targetAmount - alreadySaved);

  if (amountLeft <= 0) {
    resultDiv.innerHTML = "<p>You've already reached (or exceeded) your target — great job!</p>";
    return;
  }

  if (monthsLeft <= 0) {
    resultDiv.innerHTML = `<p>The date ${targetDate.toLocaleDateString()} is too soon — you need ₹${amountLeft.toFixed(2)} more immediately.</p>`;
    return;
  }

  const monthlySavings = amountLeft / monthsLeft;
  resultDiv.innerHTML = `<p>To reach ₹${targetAmount.toFixed(2)} by ${targetDate.toLocaleDateString()}, save ₹${monthlySavings.toFixed(2)} per month for ${monthsLeft} months.</p>`;
}
</script>


<%- include('partials/footer.ejs'); -%>
